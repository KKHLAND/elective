<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>선택과목 코드 변환 시스템</title>
    
    <!-- Libraries -->
    <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            --color-bg-page: #f8fafc;
            --color-bg-card: #ffffff;
            --color-text-main: #0f172a;
            --color-text-muted: #64748b;
            --color-primary: #4f46e5;
            --color-border: #e2e8f0;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background-color: var(--color-bg-page);
            color: var(--color-text-main);
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            min-height: 100vh;
        }

        .app-container { display: flex; flex-direction: column; min-height: 100vh; }

        .hero-header {
            background: linear-gradient(-45deg, #1e1b4b, #312e81, #4c1d95, #581c87);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: white;
            padding: 3rem 1.5rem 6rem;
            text-align: center;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .hero-title { font-size: 3.0rem; font-weight: 800; margin-bottom: 0.5rem; }
        .hero-subtitle { font-size: 1rem; opacity: 0.9; }

        .main-content {
            width: 95%; max-width: 1600px; margin: -4rem auto 2rem; position: relative; z-index: 10;
        }

        .card {
            background: var(--color-bg-card); border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg); padding: 2rem; margin-bottom: 2rem;
        }

        .config-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;
        }
        .form-control {
            width: 100%; padding: 0.75rem; border: 1px solid var(--color-border);
            border-radius: var(--radius-md); font-size: 0.95rem;
        }

        .dropzone-area {
            border: 2px dashed var(--color-border); border-radius: var(--radius-md);
            padding: 3rem; text-align: center; cursor: pointer; background: #fafafa;
            transition: all 0.2s;
        }
        .dropzone-area:hover { border-color: var(--color-primary); background: #f5f3ff; }

        .action-bar { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; }
        .btn {
            padding: 0.75rem 1.5rem; border-radius: 2rem; border: none; font-weight: 600;
            cursor: pointer; font-size: 0.95rem; display: inline-flex; align-items: center; gap: 0.5rem;
        }
        .btn-primary { background: var(--primary-gradient); color: white; }
        .btn-secondary { background: white; border: 1px solid var(--color-border); color: var(--color-text-main); }
        .btn-success { background: #10b981; color: white; } /* Added for CSV button */
        .btn-success:hover { background: #059669; }

        /* Tab Styles */
        .result-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .tab-btn {
            padding: 0.5rem 1.25rem;
            border-radius: 9999px; /* Pill shape */
            border: 1px solid var(--color-border);
            background: white;
            color: var(--color-text-muted);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .tab-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            transform: translateY(-1px);
        }

        .tab-btn.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        /* Table Styles */
        .table-wrapper {
            max-height: 70vh;
            overflow: auto;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
        }
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        .data-table th {
            background: #eef2ff; /* Pastel Blue Background */
            padding: 1rem; text-align: center; font-weight: 700;
            border-bottom: 2px solid var(--color-border); border-right: 1px solid #f1f5f9;
            position: sticky; top: 0; z-index: 10;
        }
        .data-table td {
            padding: 0.85rem; border-bottom: 1px solid var(--color-border);
            border-right: 1px solid #f1f5f9; text-align: center;
        }
        .data-table tr:hover { background-color: #f8fafc; }

        /* Stepper */
        .stepper-container { display: flex; justify-content: center; gap: 3rem; margin-bottom: 2rem; position: relative; }
        .step-item { display: flex; flex-direction: column; align-items: center; z-index: 1; position: relative;}
        .step-icon {
            width: 36px; height: 36px; border-radius: 50%; background: #e2e8f0; color: #64748b;
            display: flex; align-items: center; justify-content: center; font-weight: 700; border: 4px solid white;
        }
        .step-item.active .step-icon { background: var(--color-primary); color: white; }
        .step-item.completed .step-icon { background: #059669; color: white; }

        .error-banner {
            background: #fef2f2; color: #b91c1c; padding: 1rem; border-radius: var(--radius-md);
            margin-top: 1rem; display: flex; align-items: center; gap: 0.5rem;
        }

        /* --- Print Styles Optimized for A4 Landscape --- */
        @media print {
            body { background: white; color: black; }
            .hero-header, .stepper-container, .card, .action-bar, .no-print, .result-header button { display: none !important; }
            .main-content { width: 100%; max-width: none; margin: 0; padding: 0; }
            .result-section { box-shadow: none; border-radius: 0; }
            
            /* Hide tab buttons in print but keep content */
            .result-tabs { display: none !important; }
            
            /* Reduce margins for maximum space: 5mm margins */
            @page { size: A4 landscape; margin: 5mm; }
            
            /* Table Optimization */
            .table-wrapper { max-height: none; overflow: visible; border: none; }
            .data-table { font-size: 9pt; width: 100%; border-collapse: collapse !important; }
            
            /* Compact Rows & Single Line Enforcement */
            .data-table th, .data-table td { 
                border: 1px solid black !important; /* Uniform Solid Black Border */
                padding: 3px 4px !important; /* Slightly increased padding as requested */
                height: auto !important;
                line-height: 1.2 !important; /* Slightly increased line-height as requested */
                white-space: nowrap !important; /* FORCE SINGLE LINE */
            }
            .data-table th { 
                background-color: #eef2ff !important; 
                color: black !important; 
                -webkit-print-color-adjust: exact;
                position: static !important; /* CRITICAL FIX: Disable sticky for print to fix missing borders */
            }
            
            /* Header for Print (Revised Layout) */
            .print-header-container {
                display: flex !important;
                justify-content: center;
                align-items: flex-end; /* Align title and logo at bottom */
                position: relative;
                width: 100%;
                margin-bottom: 5px; /* Gap */
                padding-bottom: 5px;
                border-bottom: 2px solid black;
                min-height: 70px; /* Increased height to give space between title and table */
            }
            .print-title {
                text-align: center;
                font-size: 20pt;
                font-weight: bold;
                width: 100%;
                margin: 0; 
                margin-bottom: 10px; /* Add space between title and logo/line */
                z-index: 1;
            }
            /* Info row is removed, data moved to footer */
            .print-info-row { display: none !important; }
            
            .print-logo {
                position: absolute;
                right: 0;
                bottom: -25px; /* Moved down further as requested */
                width: 110px; /* Kept large size */
                height: 110px;
                object-fit: contain;
                z-index: 2;
            }

            /* Footer for Print (Date) */
            .print-footer {
                display: block !important;
                text-align: right;
                font-size: 10pt;
                margin-top: 4px;
                color: black;
            }
        }
        .print-header-container { display: none; }
        .print-footer { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useCallback, useRef, StrictMode } = React;

        const App = () => {
            const [step, setStep] = useState(1);
            const [academicYear, setAcademicYear] = useState("2026");
            const [semester, setSemester] = useState("1학기");
            const [uploadedFile, setUploadedFile] = useState(null);
            const [transformedData, setTransformedData] = useState(null);
            const [classData, setClassData] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            const [schoolLogo, setSchoolLogo] = useState(null);
            const [displayView, setDisplayView] = useState({ type: 'individual', key: 'all' });

            const logoInputRef = useRef(null);
            const fileInputRef = useRef(null);

            const handleLogoChange = (e) => {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (ev) => setSchoolLogo(ev.target.result);
                    reader.readAsDataURL(e.target.files[0]);
                }
                e.target.value = ''; // Reset input to allow re-selection
            };

            const handleFileSelect = (e) => {
                if (e.target.files && e.target.files.length > 0) {
                    setUploadedFile(e.target.files[0]);
                    setError(null);
                }
                e.target.value = ''; // Reset input to allow re-selection of the same file
            };

            // --- Core Logic: Transform Normalized Data to Result Format ---
            const transformData = useCallback((data) => {
                const baseColumns = ['순번', '학번', '이름'];
                
                if (!data || data.length === 0) return [];
                const sampleRow = data[0];
                const headers = Object.keys(sampleRow);
                
                const targetColumns = headers.filter(col => !baseColumns.includes(col));
                
                const codeHeaderPattern = /^([A-Ja-j]|Ca|Cb)$/; 
                const codeFormatMatches = targetColumns.filter(col => codeHeaderPattern.test(col.trim())).length;
                const isCodeAsHeader = codeFormatMatches > (targetColumns.length / 2);

                const pivotedDataMap = new Map();
                
                data.forEach(student => {
                    const studentId = student['학번'] ? String(student['학번']).trim() : '';
                    if (!studentId) return; 
                    
                    if (!pivotedDataMap.has(studentId)) {
                        pivotedDataMap.set(studentId, {
                            '순번': student['순번'],
                            '학번': studentId,
                            '이름': student['이름'] || '',
                        });
                    }
                    const record = pivotedDataMap.get(studentId);

                    targetColumns.forEach(col => {
                        const cellValue = student[col];
                        if (!cellValue || String(cellValue).trim() === '') return;

                        let code, subjectName;
                        const cellStr = String(cellValue).trim();

                        if (isCodeAsHeader) {
                            code = col.trim().toUpperCase(); 
                            subjectName = cellStr;
                        } else {
                            subjectName = col;
                            code = cellStr.toUpperCase(); 
                            
                            if (
                                academicYear === '2025' &&
                                studentId?.startsWith('2') &&
                                (cellStr === 'Ca' || cellStr === 'Cb') &&
                                subjectName.includes('일본어')
                            ) {
                                subjectName = `${subjectName}(${cellStr})`;
                                code = 'C';
                            }
                        }

                        if (code && subjectName) {
                            if (record[code]) {
                                if (!record[code].includes(subjectName)) {
                                    record[code] = `${record[code]}, ${subjectName}`;
                                }
                            } else {
                                record[code] = subjectName;
                            }
                        }
                    });
                });
                
                return Array.from(pivotedDataMap.values()).sort((a, b) => {
                    return parseInt(a['학번'], 10) - parseInt(b['학번'], 10);
                });
            }, [academicYear]);

            const groupDataByClass = (data) => {
                const grouped = new Map();
                data.forEach(row => {
                    const studentId = row['학번'] ? String(row['학번']) : '';
                    if (studentId.length >= 3) {
                        const classPrefix = studentId.substring(0, 3);
                        const grade = classPrefix[0];
                        const classNum = parseInt(classPrefix.substring(1), 10);
                        const className = `${grade}-${classNum}`;
                        
                        if (!grouped.has(className)) grouped.set(className, []);
                        grouped.get(className)?.push(row);
                    }
                });
                return new Map([...grouped.entries()].sort((a, b) => a[0].localeCompare(b[0], undefined, { numeric: true })));
            };

            const findHeaderRowIndex = (rows) => {
                for (let i = 0; i < Math.min(rows.length, 15); i++) {
                    const row = rows[i];
                    if (!row) continue;
                    
                    const values = Array.isArray(row) ? row : Object.values(row);
                    const strValues = values.map(v => String(v || '').trim());
                    if (strValues.includes('학번') && strValues.includes('이름')) {
                        return i;
                    }
                }
                return 0;
            };

            const handleProcess = useCallback(() => {
                if (!uploadedFile) {
                    setError("파일을 선택해주세요.");
                    return;
                }
                setIsLoading(true);
                setError(null);

                const processJsonData = (rawData) => {
                    try {
                        if (!rawData || rawData.length === 0) throw new Error("데이터가 없습니다.");
                        
                        const cleanedData = rawData.map(row => {
                            const newRow = {};
                            Object.keys(row).forEach(key => {
                                const cleanKey = key.trim(); 
                                if (cleanKey) newRow[cleanKey] = row[key];
                            });
                            return newRow;
                        });

                        const sampleKeys = Object.keys(cleanedData[0] || {});
                        if (!sampleKeys.includes('학번') || !sampleKeys.includes('이름')) {
                            throw new Error("필수 컬럼(학번, 이름)을 찾을 수 없습니다. 파일의 헤더를 확인해주세요.");
                        }

                        const transformed = transformData(cleanedData);
                        setTransformedData(transformed);
                        setClassData(groupDataByClass(transformed));
                        setStep(2); 
                    } catch (e) {
                        setError(`데이터 처리 오류: ${e.message}`);
                    } finally {
                        setIsLoading(false);
                    }
                };

                const reader = new FileReader();
                const ext = uploadedFile.name.split('.').pop().toLowerCase();

                if (ext === 'csv') {
                    reader.onload = (e) => {
                        Papa.parse(e.target.result, {
                            header: false,
                            skipEmptyLines: true,
                            encoding: 'utf-8-sig',
                            complete: (res) => {
                                const hIdx = findHeaderRowIndex(res.data);
                                const headers = res.data[hIdx]?.map(h => String(h).trim());
                                
                                if (headers && headers.includes('학번') && headers.includes('이름')) {
                                    const jsonData = res.data.slice(hIdx + 1).map(row => {
                                        const obj = {};
                                        headers.forEach((h, idx) => { if(h) obj[h] = row[idx]; });
                                        return obj;
                                    });
                                    processJsonData(jsonData);
                                } else {
                                    const reader2 = new FileReader();
                                    reader2.onload = (e2) => {
                                        Papa.parse(e2.target.result, {
                                            header: false,
                                            skipEmptyLines: true,
                                            encoding: 'EUC-KR',
                                            complete: (res2) => {
                                                const hIdx2 = findHeaderRowIndex(res2.data);
                                                const headers2 = res2.data[hIdx2]?.map(h => String(h).trim());
                                                if (headers2 && headers2.includes('학번')) {
                                                    const jsonData2 = res2.data.slice(hIdx2 + 1).map(row => {
                                                        const obj = {};
                                                        headers2.forEach((h, idx) => { if(h) obj[h] = row[idx]; });
                                                        return obj;
                                                    });
                                                    processJsonData(jsonData2);
                                                } else {
                                                    setError("CSV 인코딩을 인식할 수 없습니다. (UTF-8 또는 EUC-KR)");
                                                    setIsLoading(false);
                                                }
                                            }
                                        });
                                    };
                                    reader2.readAsText(uploadedFile, 'EUC-KR');
                                }
                            },
                            error: (err) => { setError(err.message); setIsLoading(false); }
                        });
                    };
                    reader.readAsText(uploadedFile);
                } else if (['xlsx', 'xls'].includes(ext)) {
                    reader.onload = (e) => {
                        try {
                            const workbook = XLSX.read(new Uint8Array(e.target.result), { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const rawRows = XLSX.utils.sheet_to_json(firstSheet, { header: 1, defval: '' });
                            const hIdx = findHeaderRowIndex(rawRows);
                            const headers = rawRows[hIdx]?.map(h => String(h || '').trim());
                            
                            if (!headers || !headers.includes('학번')) {
                                throw new Error("엑셀 파일에서 '학번' 헤더를 찾을 수 없습니다.");
                            }

                            const jsonData = rawRows.slice(hIdx + 1).map(row => {
                                const obj = {};
                                headers.forEach((h, idx) => {
                                    if(h) {
                                        const val = row[idx] !== undefined ? row[idx] : '';
                                        obj[h] = val;
                                    }
                                });
                                return obj;
                            });
                            
                            processJsonData(jsonData);
                        } catch (err) {
                            setError(`엑셀 파싱 오류: ${err.message}`);
                            setIsLoading(false);
                        }
                    };
                    reader.readAsArrayBuffer(uploadedFile);
                } else {
                    setError("지원하지 않는 파일 형식입니다.");
                    setIsLoading(false);
                }
            }, [uploadedFile, transformData]);

            const handleReset = () => {
                setStep(1); setUploadedFile(null); setTransformedData(null); setClassData(null);
                setDisplayView({ type: 'individual', key: 'all' });
                // Ensure input is cleared on reset as well for safety
                if (fileInputRef.current) fileInputRef.current.value = '';
            };

            const getDisplayContent = () => {
                if (!transformedData) return null;
                if (displayView.type === 'individual') {
                    const grade = transformedData[0]?.['학번']?.[0] || '1'; 
                    return { 
                        title: `${academicYear}학년도 ${semester} 선택과목 현황 (전체)`, 
                        data: transformedData, grade 
                    };
                }
                if (displayView.type === 'class' && classData) {
                    const data = classData.get(displayView.key) || [];
                    const grade = displayView.key[0];
                    return { 
                        title: `${academicYear}학년도 ${semester} ${displayView.key}반 선택과목 현황`, 
                        data, grade 
                    };
                }
                return null;
            };

            const displayedContent = getDisplayContent();

            const getColumns = () => {
                if (!displayedContent) return [];
                const base = ['학번', '이름'];
                const grade2Codes = ['A', 'B', 'C', 'D', 'E'];
                const grade3Codes = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
                
                if (displayedContent.grade === '2') return [...base, ...grade2Codes];
                if (displayedContent.grade === '3') return [...base, ...grade3Codes];

                const extended = ['F', 'G', 'H', 'I', 'J'];
                const hasExtended = displayedContent.data.some(row => extended.some(c => row[c]));
                return hasExtended ? [...base, ...grade3Codes] : [...base, ...grade2Codes];
            };
            const columns = getColumns();

            // --- CSV Download Handler ---
            const handleDownloadCSV = () => {
                if (!displayedContent) return;

                const { title, data } = displayedContent;
                // Use the calculated columns for order
                const csvColumns = columns;
                
                // Map data to ensure correct column order
                const csvData = data.map(row => {
                    const rowData = {};
                    csvColumns.forEach(col => {
                        rowData[col] = row[col] || '';
                    });
                    return rowData;
                });

                // Generate CSV with BOM for Korean support
                const csv = Papa.unparse({
                    fields: csvColumns,
                    data: csvData
                });
                const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `${title}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            return (
                <div className="app-container">
                    <header className="hero-header no-print">
                        <h1 className="hero-title">선택과목 코드 변환 시스템</h1>
                        <p className="hero-subtitle">학년별, 학급별 선택과목 자동 변환 (CSV / Excel)</p>
                    </header>

                    <main className="main-content">
                        {/* Stepper */}
                        <div className="stepper-container no-print">
                            <div className={`step-item ${step >= 1 ? 'active' : ''} ${step > 1 ? 'completed' : ''}`}>
                                <div className="step-icon">{step > 1 ? <i className="ph ph-check"></i> : "1"}</div>
                                <span className="step-label mt-2">파일 업로드</span>
                            </div>
                            <div className="absolute top-4 w-40 border-t-2 border-gray-200 z-0"></div>
                            <div className={`step-item ${step >= 2 ? 'active' : ''}`}>
                                <div className="step-icon">2</div>
                                <span className="step-label mt-2">결과 확인</span>
                            </div>
                        </div>

                        {step === 1 && (
                            <div className="card">
                                <div className="config-grid">
                                    <div className="form-group">
                                        <label>학년도</label>
                                        <input type="number" className="form-control" value={academicYear} onChange={(e) => setAcademicYear(e.target.value)} />
                                    </div>
                                    <div className="form-group">
                                        <label>학기</label>
                                        <select className="form-control" value={semester} onChange={(e) => setSemester(e.target.value)}>
                                            <option>1학기</option><option>2학기</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>학교 로고</label>
                                        <div className="flex gap-2">
                                            <button className="btn btn-secondary w-full justify-center" onClick={() => logoInputRef.current?.click()}>
                                                <i className="ph ph-image"></i> {schoolLogo ? "변경" : "등록"}
                                            </button>
                                            <input type="file" ref={logoInputRef} onChange={handleLogoChange} className="hidden" accept="image/*" />
                                        </div>
                                    </div>
                                </div>

                                <div className="dropzone-area" onClick={() => fileInputRef.current?.click()}>
                                    <input type="file" ref={fileInputRef} onChange={handleFileSelect} className="hidden" accept=".csv, .xlsx, .xls" />
                                    <i className={`ph ${uploadedFile ? 'ph-file-csv text-green-600' : 'ph-upload-simple text-gray-400'} text-5xl mb-2`}></i>
                                    <div className="font-bold text-lg text-gray-700">{uploadedFile ? uploadedFile.name : "파일 선택"}</div>
                                    <div className="text-sm text-gray-500 mt-1">{uploadedFile ? "파일이 준비되었습니다." : "클릭하거나 파일을 드래그하세요"}</div>
                                </div>

                                {error && (
                                    <div className="error-banner">
                                        <i className="ph ph-warning-circle text-xl"></i> <span>{error}</span>
                                    </div>
                                )}

                                <div className="action-bar">
                                    <button className="btn btn-primary" onClick={handleProcess} disabled={!uploadedFile || isLoading}>
                                        {isLoading ? <><i className="ph ph-spinner animate-spin"></i> 처리 중...</> : <><i className="ph ph-magic-wand"></i> 변환 시작</>}
                                    </button>
                                </div>
                            </div>
                        )}

                        {step === 2 && displayedContent && (
                            <div className="result-section">
                                <div className="result-header no-print">
                                    <div className="flex items-center gap-4 flex-1">
                                        <h2 className="result-title">변환 결과</h2>
                                        <span className="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-sm font-medium">총 {displayedContent.data.length}명</span>
                                    </div>
                                    <div className="flex gap-2 items-center flex-wrap">
                                        {classData && (
                                            <div className="result-tabs">
                                                <button className={`tab-btn ${displayView.type === 'individual' ? 'active' : ''}`} onClick={() => setDisplayView({ type: 'individual', key: 'all'})}>전체</button>
                                                {Array.from(classData.keys()).map(cls => (
                                                    <button key={cls} className={`tab-btn ${displayView.type === 'class' && displayView.key === cls ? 'active' : ''}`} onClick={() => setDisplayView({ type: 'class', key: cls})}>{cls}반</button>
                                                ))}
                                            </div>
                                        )}
                                        <div className="w-px h-8 bg-gray-200 mx-2 hidden md:block"></div>
                                        <button className="btn btn-secondary" onClick={handleReset}><i className="ph ph-arrow-counter-clockwise"></i> 처음으로</button>
                                        <button className="btn btn-success" onClick={handleDownloadCSV}><i className="ph ph-file-csv"></i> 엑셀 다운로드</button>
                                        <button className="btn btn-primary" onClick={() => window.print()}><i className="ph ph-printer"></i> 인쇄</button>
                                    </div>
                                </div>

                                {/* Print Header */}
                                <div className="print-header-container">
                                    <h1 className="print-title">{displayedContent.title}</h1>
                                    {schoolLogo && <img src={schoolLogo} alt="Logo" className="print-logo" />}
                                </div>

                                <div className="table-wrapper">
                                    <table className="data-table">
                                        <thead>
                                            <tr>
                                                {columns.map(col => <th key={col}>{col}</th>)}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {displayedContent.data.map((row, idx) => (
                                                <tr key={idx}>
                                                    {columns.map(col => <td key={col}>{row[col] || ''}</td>)}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>

                                {/* Print Footer (Date) */}
                                <div className="print-footer">
                                    출력일: {new Date().toLocaleDateString()}
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StrictMode><App /></StrictMode>);
    </script>
</body>
</html>


